<%- include('../partials/header') %>

    <!-- Dashboard Specific Styles & Resources -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        .sidebar-link {
            transition: all 0.3s ease;
        }

        .sidebar-link:hover,
        .sidebar-link.active {
            background-color: #EBF8FF;
            color: #003B73;
            border-right: 4px solid #003B73;
        }

        .stat-card {
            transition: transform 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-5px);
        }

        .glass-effect {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
        }
    </style>

    <div class="flex-1 flex flex-col md:flex-row p-6 gap-6 max-w-[1600px] mx-auto w-full">

        <!-- Sidebar -->
        <aside class="w-full md:w-64 flex-shrink-0">
            <div class="bg-white rounded-2xl shadow-sm p-4 h-full min-h-[600px]">
                <div class="space-y-2">
                    <a href="/admin/dashboard"
                        class="sidebar-link <%= page === 'home' ? 'active' : '' %> flex items-center gap-3 px-4 py-3 text-gray-600 rounded-lg hover:bg-gray-50 text-sm font-medium">
                        <i class="fas fa-home w-5"></i> Home Page
                    </a>
                    <% if (user.role !=='rep_admin' ) { %>
                        <a href="/admin/members"
                            class="sidebar-link <%= page === 'members' ? 'active' : '' %> flex items-center gap-3 px-4 py-3 text-gray-600 rounded-lg hover:bg-gray-50 text-sm font-medium">
                            <i class="fas fa-users w-5"></i> Member Management
                        </a>
                        <% } %>
                            <a href="/admin/nsmosa-events"
                                class="sidebar-link <%= page === 'nsmosa_events' ? 'active' : '' %> flex items-center gap-3 px-4 py-3 text-gray-600 rounded-lg hover:bg-gray-50 text-sm font-medium">
                                <i class="fas fa-calendar-alt w-5"></i> NSM ALUMNI EVENTS
                            </a>
                            <a href="/admin/photo-gallery"
                                class="sidebar-link <%= page === 'photo_gallery' ? 'active' : '' %> flex items-center gap-3 px-4 py-3 text-gray-600 rounded-lg hover:bg-gray-50 text-sm font-medium">
                                <i class="fas fa-images w-5"></i> Photo Gallery
                            </a>
                            <a href="/admin/reunion-gallery"
                                class="sidebar-link <%= page === 'reunion_gallery' ? 'active' : '' %> flex items-center gap-3 px-4 py-3 text-gray-600 rounded-lg hover:bg-gray-50 text-sm font-medium">
                                <i class="fas fa-handshake w-5"></i> Reunion Photo Gallery
                            </a>
                            <a href="/admin/alumni-events"
                                class="sidebar-link <%= page === 'alumni_events' ? 'active' : '' %> flex items-center gap-3 px-4 py-3 text-gray-600 rounded-lg hover:bg-gray-50 text-sm font-medium">
                                <i class="fas fa-calendar-check w-5"></i> Alumni Event
                            </a>
                            <% if (user.role !=='rep_admin' ) { %>
                                <a href="/admin/alumni-directory"
                                    class="sidebar-link <%= page === 'alumni_directory' ? 'active' : '' %> flex items-center gap-3 px-4 py-3 text-gray-600 rounded-lg hover:bg-gray-50 text-sm font-medium">
                                    <i class="fas fa-address-book w-5"></i> Alumni Directory
                                </a>
                                <a href="/admin/business-directory"
                                    class="sidebar-link <%= page === 'business_directory' ? 'active' : '' %> flex items-center gap-3 px-4 py-3 text-gray-600 rounded-lg hover:bg-gray-50 text-sm font-medium">
                                    <i class="fas fa-briefcase w-5"></i> Business Directory
                                </a>
                                <a href="/admin/executive-committee"
                                    class="sidebar-link <%= page === 'executive_committee' ? 'active' : '' %> flex items-center gap-3 px-4 py-3 text-gray-600 rounded-lg hover:bg-gray-50 text-sm font-medium">
                                    <i class="fas fa-user-tie w-5"></i> Executive Committee
                                </a>
                                <a href="/admin/financial-reports"
                                    class="sidebar-link <%= page === 'financial_reports' ? 'active' : '' %> flex items-center gap-3 px-4 py-3 text-gray-600 rounded-lg hover:bg-gray-50 text-sm font-medium">
                                    <i class="fas fa-file-invoice-dollar w-5"></i> Financial Reports
                                </a>
                                <% } %>

                                    <div class="mt-8 border-t pt-4">
                                        <a href="/auth/logout"
                                            class="flex items-center gap-3 px-4 py-3 text-red-500 rounded-lg hover:bg-red-50 text-sm font-medium transition">
                                            <i class="fas fa-sign-out-alt w-5"></i> Logout
                                        </a>
                                    </div>
                </div>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="flex-1 flex flex-col gap-6">

            <!-- Top Stats Row -->
            <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4">

                <!-- Welcome Card -->
                <div
                    class="bg-white rounded-2xl shadow-sm p-4 flex items-center gap-4 border border-gray-100 relative overflow-hidden">
                    <div class="w-12 h-12 rounded-full bg-blue-50 flex items-center justify-center text-blue-600">
                        <i class="fas fa-user-shield text-xl"></i>
                    </div>
                    <div>
                        <h3 class="font-bold text-gray-900">Welcome to <%= displayName %>
                        </h3>
                        <span
                            class="inline-block bg-[#003B73] text-white text-[10px] px-2 py-0.5 rounded-full uppercase tracking-wider font-semibold">Admin
                            Access</span>
                    </div>
                </div>

                <% if (user.role !=='rep_admin' ) { %>
                    <!-- Total Members -->
                    <div
                        class="stat-card bg-white rounded-2xl shadow-sm p-4 flex items-center gap-4 border border-gray-100 relative overflow-hidden group">
                        <div
                            class="absolute -right-4 -bottom-4 w-24 h-24 bg-red-50 rounded-full group-hover:scale-110 transition">
                        </div>
                        <div class="w-12 h-12 rounded-xl bg-red-100 flex items-center justify-center text-red-500 z-10">
                            <i class="fas fa-users text-xl"></i>
                        </div>
                        <div class="z-10">
                            <h4 class="text-2xl font-bold text-gray-900">
                                <%= totalMembers %>
                            </h4>
                            <p class="text-xs text-gray-500 uppercase font-bold tracking-wide">Total Members</p>
                        </div>
                    </div>

                    <!-- Pending Approval -->
                    <div
                        class="stat-card bg-white rounded-2xl shadow-sm p-4 flex items-center gap-4 border border-gray-100 relative overflow-hidden group">
                        <div
                            class="absolute -right-4 -bottom-4 w-24 h-24 bg-orange-50 rounded-full group-hover:scale-110 transition">
                        </div>
                        <div
                            class="w-12 h-12 rounded-xl bg-orange-100 flex items-center justify-center text-orange-500 z-10">
                            <i class="fas fa-user-clock text-xl"></i>
                        </div>
                        <div class="z-10">
                            <h4 class="text-2xl font-bold text-gray-900">
                                <%= pendingApproval %>
                            </h4>
                            <p class="text-xs text-gray-500 uppercase font-bold tracking-wide">Pending Approval</p>
                        </div>
                    </div>

                    <!-- Total Collections -->
                    <div
                        class="stat-card bg-white rounded-2xl shadow-sm p-4 flex items-center gap-4 border border-gray-100 relative overflow-hidden group">
                        <div
                            class="absolute -right-4 -bottom-4 w-24 h-24 bg-red-50 rounded-full group-hover:scale-110 transition">
                        </div>
                        <div class="w-12 h-12 rounded-xl bg-red-100 flex items-center justify-center text-red-500 z-10">
                            <span class="text-lg font-bold">Rs</span>
                        </div>
                        <div class="z-10">
                            <h4 class="text-2xl font-bold text-gray-900">
                                <%= totalCollections.toLocaleString() %>
                            </h4>
                            <p class="text-xs text-gray-500 uppercase font-bold tracking-wide">Total Collections</p>
                        </div>
                    </div>
                    <% } %>
            </div>

            <!-- Content Management Area -->
            <% if (page==='home' ) { %>
                <div
                    class="bg-white rounded-2xl shadow-sm border border-gray-100 flex-1 flex flex-col p-6 relative min-h-[600px]">
                    <h2 class="text-[#003B73] text-xl font-bold mb-6">Home Page Content Management</h2>

                    <%- include('../partials/messages') %>

                        <!-- Tabs -->
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-8">
                            <a href="/admin/dashboard?section=nsmosa_events"
                                class="flex items-center justify-center gap-2 p-4 rounded-xl border <%= section === 'nsmosa_events' ? 'border-[#003B73] bg-blue-50 text-[#003B73]' : 'border-gray-200 hover:border-gray-300' %> transition group">
                                <i
                                    class="fas fa-calendar-alt <%= section === 'nsmosa_events' ? 'text-[#003B73]' : 'text-gray-400 group-hover:text-gray-600' %>"></i>
                                <span class="font-medium text-sm">NSMOSA Events</span>
                            </a>
                            <a href="/admin/dashboard?section=middle_box"
                                class="flex items-center justify-center gap-2 p-4 rounded-xl border <%= section === 'middle_box' ? 'border-[#003B73] bg-blue-50 text-[#003B73]' : 'border-gray-200 hover:border-gray-300' %> transition group">
                                <i
                                    class="fas fa-image <%= section === 'middle_box' ? 'text-[#003B73]' : 'text-gray-400 group-hover:text-gray-600' %>"></i>
                                <span class="font-medium text-sm">Middle Box Images</span>
                            </a>
                            <a href="/admin/dashboard?section=photo_gallery"
                                class="flex items-center justify-center gap-2 p-4 rounded-xl border <%= section === 'photo_gallery' ? 'border-[#003B73] bg-blue-50 text-[#003B73]' : 'border-gray-200 hover:border-gray-300' %> transition group">
                                <i
                                    class="fas fa-images <%= section === 'photo_gallery' ? 'text-[#003B73]' : 'text-gray-400 group-hover:text-gray-600' %>"></i>
                                <span class="font-medium text-sm">Photo Gallery</span>
                            </a>
                        </div>

                        <!-- Dynamic Content Area -->
                        <div
                            class="border-t border-dashed border-gray-200 pt-8 mt-auto flex-1 flex items-center justify-center w-full">

                            <% if (!section) { %>
                                <!-- Placeholder State -->
                                <div class="text-center">
                                    <i class="fas fa-home text-6xl text-gray-200 mb-4"></i>
                                    <h3 class="text-[#003B73] font-bold text-lg">Select a Section to Manage</h3>
                                    <p class="text-gray-400 text-sm max-w-xs mx-auto mt-2">Choose one of the categories
                                        above to manage content displayed on the Home Page.</p>
                                </div>
                                <% } else { %>

                                    <!-- Form Area -->
                                    <div class="w-full max-w-2xl mx-auto">
                                        <% if (section==='nsmosa_events' ) { %>
                                            <div class="bg-gray-50 p-6 rounded-xl border border-gray-200">
                                                <h3 class="font-bold text-gray-800 mb-4 flex items-center gap-2">
                                                    <i class="fas fa-calendar-alt text-blue-600"></i> Update NSMOSA
                                                    Events
                                                </h3>

                                                <!-- Toggle Button -->
                                                <div id="add-image-btn-container" class="text-center py-8">
                                                    <button
                                                        onclick="document.getElementById('nsmosa-event-form').classList.remove('hidden'); document.getElementById('add-image-btn-container').classList.add('hidden');"
                                                        class="bg-blue-600 text-white font-bold py-3 px-6 rounded-full hover:bg-blue-700 transition shadow-lg flex items-center gap-2 mx-auto">
                                                        <i class="fas fa-plus-circle"></i> Add Images
                                                    </button>
                                                    <p class="text-gray-400 text-sm mt-2">Click to upload new event
                                                        images
                                                    </p>
                                                </div>

                                                <form id="nsmosa-event-form" action="/admin/create" method="POST"
                                                    enctype="multipart/form-data"
                                                    class="hidden transition-all duration-300">
                                                    <input type="hidden" name="section" value="home_nsmosa_events">
                                                    <input type="hidden" name="title" value="NSMOSA Event">

                                                    <div class="space-y-4">
                                                        <!-- File Upload -->
                                                        <div
                                                            class="p-4 border-2 border-dashed border-blue-200 rounded-xl bg-blue-50/50 hover:bg-blue-50 transition">
                                                            <label
                                                                class="block text-xs font-bold text-gray-500 uppercase mb-2">Upload
                                                                Image</label>
                                                            <input type="file" name="image" accept="image/*" required
                                                                class="w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-blue-600 file:text-white hover:file:bg-blue-700 transition">
                                                            <p class="text-xs text-gray-400 mt-2">Supported formats:
                                                                JPG,
                                                                PNG, JPEG</p>
                                                        </div>

                                                        <div>
                                                            <label
                                                                class="block text-xs font-bold text-gray-500 uppercase mb-1">Description</label>
                                                            <textarea name="description" rows="3"
                                                                class="w-full rounded-lg border-gray-300 focus:border-blue-500 focus:ring-blue-500"></textarea>
                                                        </div>

                                                        <div class="flex gap-3">
                                                            <button type="button"
                                                                onclick="document.getElementById('nsmosa-event-form').classList.add('hidden'); document.getElementById('add-image-btn-container').classList.remove('hidden');"
                                                                class="flex-1 bg-gray-200 text-gray-700 font-bold py-3 rounded-xl hover:bg-gray-300 transition">Cancel</button>
                                                            <button type="submit"
                                                                class="flex-1 bg-[#003B73] text-white font-bold py-3 rounded-xl hover:bg-[#002a52] transition">Save
                                                                Event</button>
                                                        </div>
                                                    </div>
                                                </form>

                                                <!-- Display Session Uploaded Images -->
                                                <% const recentUploads=uploadedSessionImages.filter(img=> img.section
                                                    ===
                                                    'home_nsmosa_events');
                                                    if (recentUploads.length > 0) {
                                                    %>
                                                    <div class="mt-8 pt-6 border-t border-gray-200">
                                                        <h4 class="text-sm font-bold text-gray-600 uppercase mb-4">
                                                            Recently
                                                            Uploaded (This Session)</h4>
                                                        <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                                                            <% recentUploads.forEach(img=> { %>
                                                                <div
                                                                    class="relative group rounded-lg overflow-hidden border border-gray-200 shadow-sm aspect-w-1 aspect-h-1 bg-gray-100">
                                                                    <img src="<%= img.imageUrl %>"
                                                                        class="object-cover w-full h-24 md:h-32">

                                                                    <!-- Overlay Actions -->
                                                                    <div
                                                                        class="absolute inset-0 bg-black/0 group-hover:bg-black/20 transition-all flex flex-col justify-between p-2 opacity-0 group-hover:opacity-100">
                                                                        <div class="flex justify-end">
                                                                            <form action="/admin/delete/<%= img.id %>"
                                                                                method="POST"
                                                                                onsubmit="return confirm('Are you sure you want to delete this image?');">
                                                                                <button type="submit"
                                                                                    class="bg-red-500 text-white rounded-full w-6 h-6 flex items-center justify-center hover:bg-red-600 transition shadow-sm"
                                                                                    title="Delete Image">
                                                                                    <i class="fas fa-times text-xs"></i>
                                                                                </button>
                                                                            </form>
                                                                        </div>
                                                                        <p
                                                                            class="text-white text-xs font-medium truncate">
                                                                            <%= img.title %>
                                                                        </p>
                                                                    </div>
                                                                </div>
                                                                <% }) %>
                                                        </div>
                                                    </div>
                                                    <% } %>
                                            </div>
                                            <% } else if (section==='middle_box' ) { %>
                                                <div class="bg-gray-50 p-6 rounded-xl border border-gray-200">
                                                    <h3 class="font-bold text-gray-800 mb-4 flex items-center gap-2">
                                                        <i class="fas fa-image text-purple-600"></i> Update Middle Box
                                                        Slider
                                                    </h3>

                                                    <!-- Toggle Button -->
                                                    <div id="add-middle-box-btn-container" class="text-center py-8">
                                                        <button
                                                            onclick="document.getElementById('middle-box-form').classList.remove('hidden'); document.getElementById('add-middle-box-btn-container').classList.add('hidden');"
                                                            class="bg-purple-600 text-white font-bold py-3 px-6 rounded-full hover:bg-purple-700 transition shadow-lg flex items-center gap-2 mx-auto">
                                                            <i class="fas fa-plus-circle"></i> Add Images
                                                        </button>
                                                        <p class="text-gray-400 text-sm mt-2">Click to upload new slider
                                                            images</p>
                                                    </div>

                                                    <form id="middle-box-form" action="/admin/create" method="POST"
                                                        enctype="multipart/form-data"
                                                        class="hidden transition-all duration-300">
                                                        <input type="hidden" name="section" value="home_middle_box">
                                                        <input type="hidden" name="title" value="Middle Box Image">
                                                        <div class="space-y-4">
                                                            <!-- File Upload -->
                                                            <div
                                                                class="p-4 border-2 border-dashed border-purple-200 rounded-xl bg-purple-50/50 hover:bg-purple-50 transition">
                                                                <label
                                                                    class="block text-xs font-bold text-gray-500 uppercase mb-2">Upload
                                                                    Image</label>
                                                                <input type="file" name="image" accept="image/*"
                                                                    required
                                                                    class="w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-purple-600 file:text-white hover:file:bg-purple-700 transition">
                                                                <p class="text-xs text-gray-400 mt-2">Supported formats:
                                                                    JPG, PNG, JPEG</p>
                                                            </div>

                                                            <div>
                                                                <label
                                                                    class="block text-xs font-bold text-gray-500 uppercase mb-1">Description</label>
                                                                <textarea name="description" rows="3"
                                                                    class="w-full rounded-lg border-gray-300 focus:border-purple-500 focus:ring-purple-500"></textarea>
                                                            </div>

                                                            <div class="flex gap-3">
                                                                <button type="button"
                                                                    onclick="document.getElementById('middle-box-form').classList.add('hidden'); document.getElementById('add-middle-box-btn-container').classList.remove('hidden');"
                                                                    class="flex-1 bg-gray-200 text-gray-700 font-bold py-3 rounded-xl hover:bg-gray-300 transition">Cancel</button>
                                                                <button type="submit"
                                                                    class="flex-1 bg-purple-600 text-white font-bold py-3 rounded-xl hover:bg-purple-700 transition">Upload
                                                                    & Save</button>
                                                            </div>
                                                        </div>
                                                    </form>

                                                    <!-- Display Session Uploaded Images -->
                                                    <% const recentMiddleBox=uploadedSessionImages.filter(img=>
                                                        img.section
                                                        === 'home_middle_box');
                                                        if (recentMiddleBox.length > 0) { %>
                                                        <div class="mt-8 pt-6 border-t border-gray-200">
                                                            <h4 class="text-sm font-bold text-gray-600 uppercase mb-4">
                                                                Recently Uploaded (This Session)</h4>
                                                            <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                                                                <% recentMiddleBox.forEach(img=> { %>
                                                                    <div
                                                                        class="relative group rounded-lg overflow-hidden border border-gray-200 shadow-sm aspect-w-1 aspect-h-1 bg-gray-100">
                                                                        <img src="<%= img.imageUrl %>"
                                                                            class="object-cover w-full h-24 md:h-32">
                                                                        <!-- Overlay Actions -->
                                                                        <div
                                                                            class="absolute inset-0 bg-black/0 group-hover:bg-black/20 transition-all flex flex-col justify-between p-2 opacity-0 group-hover:opacity-100">
                                                                            <div class="flex justify-end">
                                                                                <form
                                                                                    action="/admin/delete/<%= img.id %>"
                                                                                    method="POST"
                                                                                    onsubmit="return confirm('Are you sure you want to delete this image?');">
                                                                                    <button type="submit"
                                                                                        class="bg-red-500 text-white rounded-full w-6 h-6 flex items-center justify-center hover:bg-red-600 transition shadow-sm"
                                                                                        title="Delete Image">
                                                                                        <i
                                                                                            class="fas fa-times text-xs"></i>
                                                                                    </button>
                                                                                </form>
                                                                            </div>
                                                                            <p
                                                                                class="text-white text-xs font-medium truncate">
                                                                                <%= img.title %>
                                                                            </p>
                                                                        </div>
                                                                    </div>
                                                                    <% }) %>
                                                            </div>
                                                        </div>
                                                        <% } %>
                                                </div>
                                                <% } else if (section==='photo_gallery' ) { %>
                                                    <div class="bg-gray-50 p-6 rounded-xl border border-gray-200">
                                                        <h3
                                                            class="font-bold text-gray-800 mb-4 flex items-center gap-2">
                                                            <i class="fas fa-images text-yellow-600"></i> Update Photo
                                                            Gallery
                                                        </h3>

                                                        <!-- Toggle Button -->
                                                        <div id="add-gallery-btn-container" class="text-center py-8">
                                                            <button
                                                                onclick="document.getElementById('gallery-form').classList.remove('hidden'); document.getElementById('add-gallery-btn-container').classList.add('hidden');"
                                                                class="bg-yellow-600 text-white font-bold py-3 px-6 rounded-full hover:bg-yellow-700 transition shadow-lg flex items-center gap-2 mx-auto">
                                                                <i class="fas fa-plus-circle"></i> Add Images
                                                            </button>
                                                            <p class="text-gray-400 text-sm mt-2">Click to upload new
                                                                gallery images</p>
                                                        </div>

                                                        <form id="gallery-form" action="/admin/create" method="POST"
                                                            enctype="multipart/form-data"
                                                            class="hidden transition-all duration-300">
                                                            <input type="hidden" name="section"
                                                                value="home_photo_gallery">
                                                            <input type="hidden" name="title" value="Gallery Image">
                                                            <div class="space-y-4">
                                                                <!-- File Upload -->
                                                                <div
                                                                    class="p-4 border-2 border-dashed border-yellow-200 rounded-xl bg-yellow-50/50 hover:bg-yellow-50 transition">
                                                                    <label
                                                                        class="block text-xs font-bold text-gray-500 uppercase mb-2">Upload
                                                                        Image</label>
                                                                    <input type="file" name="image" accept="image/*"
                                                                        required
                                                                        class="w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-yellow-600 file:text-white hover:file:bg-yellow-700 transition">
                                                                    <p class="text-xs text-gray-400 mt-2">Supported
                                                                        formats:
                                                                        JPG, PNG, JPEG</p>
                                                                </div>

                                                                <div class="flex gap-3">
                                                                    <button type="button"
                                                                        onclick="document.getElementById('gallery-form').classList.add('hidden'); document.getElementById('add-gallery-btn-container').classList.remove('hidden');"
                                                                        class="flex-1 bg-gray-200 text-gray-700 font-bold py-3 rounded-xl hover:bg-gray-300 transition">Cancel</button>
                                                                    <button type="submit"
                                                                        class="flex-1 bg-yellow-600 text-white font-bold py-3 rounded-xl hover:bg-yellow-700 transition">Upload
                                                                        & Save</button>
                                                                </div>
                                                            </div>
                                                        </form>

                                                        <!-- Display Session Uploaded Images -->
                                                        <% const recentGallery=uploadedSessionImages.filter(img=>
                                                            img.section === 'home_photo_gallery');
                                                            if (recentGallery.length > 0) { %>
                                                            <div class="mt-8 pt-6 border-t border-gray-200">
                                                                <h4
                                                                    class="text-sm font-bold text-gray-600 uppercase mb-4">
                                                                    Recently Uploaded (This Session)</h4>
                                                                <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                                                                    <% recentGallery.forEach(img=> { %>
                                                                        <div
                                                                            class="relative group rounded-lg overflow-hidden border border-gray-200 shadow-sm aspect-w-1 aspect-h-1 bg-gray-100">
                                                                            <img src="<%= img.imageUrl %>"
                                                                                class="object-cover w-full h-24 md:h-32">
                                                                            <!-- Overlay Actions -->
                                                                            <div
                                                                                class="absolute inset-0 bg-black/0 group-hover:bg-black/20 transition-all flex flex-col justify-between p-2 opacity-0 group-hover:opacity-100">
                                                                                <div class="flex justify-end">
                                                                                    <form
                                                                                        action="/admin/delete/<%= img.id %>"
                                                                                        method="POST"
                                                                                        onsubmit="return confirm('Are you sure you want to delete this image?');">
                                                                                        <button type="submit"
                                                                                            class="bg-red-500 text-white rounded-full w-6 h-6 flex items-center justify-center hover:bg-red-600 transition shadow-sm"
                                                                                            title="Delete Image">
                                                                                            <i
                                                                                                class="fas fa-times text-xs"></i>
                                                                                        </button>
                                                                                    </form>
                                                                                </div>
                                                                                <p
                                                                                    class="text-white text-xs font-medium truncate">
                                                                                    <%= img.title %>
                                                                                </p>
                                                                            </div>
                                                                        </div>
                                                                        <% }) %>
                                                                </div>
                                                            </div>
                                                            <% } %>
                                                    </div>
                                                    <% } %>
                                    </div>
                                    <% } %>

                        </div>
                </div>
                <% } else if (page==='members' ) { %>
                    <div
                        class="bg-white rounded-2xl shadow-sm border border-gray-100 flex-1 flex flex-col p-6 relative min-h-[600px]">
                        <div class="flex items-center justify-between mb-6">
                            <h2 class="text-[#003B73] text-xl font-bold">Member Management</h2>
                            <span class="bg-blue-50 text-blue-600 px-3 py-1 rounded-full text-xs font-bold">
                                <%= typeof members !=='undefined' ? members.length : 0 %> Members
                            </span>
                        </div>

                        <div class="overflow-x-auto md:overflow-visible">
                            <table class="w-full text-left border-collapse">
                                <thead>
                                    <tr class="text-xs text-gray-400 border-b border-gray-100 uppercase tracking-wider">
                                        <th class="py-3 font-semibold pl-4">Member Info</th>
                                        <th class="py-3 font-semibold">Role</th>
                                        <th class="py-3 font-semibold">Status</th>
                                        <th class="py-3 font-semibold">Joined Date</th>
                                        <th class="py-3 font-semibold text-right pr-4">Actions</th>
                                    </tr>
                                </thead>
                                <tbody class="text-sm divide-y divide-gray-50">
                                    <% if (typeof members !=='undefined' ) { %>
                                        <% members.forEach(member=> { %>
                                            <tr class="hover:bg-gray-50/50 transition group">
                                                <td class="py-3 pl-4">
                                                    <div class="flex items-center gap-3">
                                                        <div
                                                            class="w-10 h-10 rounded-full bg-gradient-to-br from-blue-50 to-blue-100 flex items-center justify-center text-blue-600 font-bold shadow-sm">
                                                            <%= member.fullName && member.fullName.length> 0 ?
                                                                member.fullName.charAt(0).toUpperCase() : 'U' %>
                                                        </div>
                                                        <div>
                                                            <p class="font-bold text-gray-800">
                                                                <%= member.fullName || 'Unknown' %>
                                                            </p>
                                                            <p class="text-xs text-gray-500">
                                                                <%= member.email %>
                                                            </p>
                                                        </div>
                                                    </div>
                                                </td>
                                                <td class="py-3">
                                                    <span
                                                        class="px-3 py-1 rounded-full text-[10px] font-bold uppercase tracking-wide
                                                <%= member.role === 'super_admin' ? 'bg-purple-100 text-purple-600' : 
                                                   member.role === 'admin' ? 'bg-blue-100 text-blue-600' : 
                                                   member.role === 'rep_admin' ? 'bg-orange-100 text-orange-600' : 'bg-gray-100 text-gray-600' %>">
                                                        <%= member.role ? member.role.replace('_', ' ' ) : 'USER' %>
                                                    </span>
                                                </td>
                                                <td class="py-3">
                                                    <div class="flex items-center gap-2">
                                                        <span
                                                            class="w-1.5 h-1.5 rounded-full <%= member.membershipStatus === 'active' ? 'bg-green-500' : 'bg-yellow-500' %>"></span>
                                                        <span class="text-xs font-bold text-gray-600">
                                                            <%= member.membershipStatus ?
                                                                member.membershipStatus.toUpperCase() : 'PENDING' %>
                                                        </span>
                                                    </div>
                                                </td>
                                                <td class="py-3 text-gray-500 font-medium text-xs">
                                                    <%= new Date(member.createdAt).toLocaleDateString('en-US', {
                                                        year: 'numeric' , month: 'short' , day: 'numeric' }) %>
                                                </td>
                                                <td class="py-3 text-right pr-4">
                                                    <% if (['admin', 'super_admin' ].includes(user.role)) { %>
                                                        <div class="relative inline-block text-left group">
                                                            <button
                                                                class="text-gray-400 hover:text-blue-600 transition p-2 rounded-full hover:bg-blue-50">
                                                                <i class="fas fa-ellipsis-v"></i>
                                                            </button>
                                                            <!-- Dropdown menu -->
                                                            <div
                                                                class="hidden group-hover:block absolute right-0 mt-0 w-48 rounded-xl shadow-lg bg-white ring-1 ring-black ring-opacity-5 z-50 overflow-hidden">
                                                                <div class="py-1">
                                                                    <% if (member.role !=='rep_admin' ) { %>
                                                                        <form action="/admin/update-role" method="POST">
                                                                            <input type="hidden" name="userId"
                                                                                value="<%= member.id %>">
                                                                            <input type="hidden" name="newRole"
                                                                                value="rep_admin">
                                                                            <button type="submit"
                                                                                class="block w-full text-left px-4 py-3 text-sm text-gray-700 hover:bg-orange-50 hover:text-orange-700 font-medium transition flex items-center gap-2">
                                                                                <i
                                                                                    class="fas fa-user-shield text-orange-400"></i>
                                                                                Make Rep Admin
                                                                            </button>
                                                                        </form>
                                                                        <% } %>

                                                                            <% if (member.role !=='admin' &&
                                                                                user.role==='super_admin' ) { %>
                                                                                <form action="/admin/update-role"
                                                                                    method="POST">
                                                                                    <input type="hidden" name="userId"
                                                                                        value="<%= member.id %>">
                                                                                    <input type="hidden" name="newRole"
                                                                                        value="admin">
                                                                                    <button type="submit"
                                                                                        class="block w-full text-left px-4 py-3 text-sm text-gray-700 hover:bg-blue-50 hover:text-blue-700 font-medium transition flex items-center gap-2">
                                                                                        <i
                                                                                            class="fas fa-user-tie text-blue-400"></i>
                                                                                        Make Admin
                                                                                    </button>
                                                                                </form>
                                                                                <% } %>

                                                                                    <% if (member.role !=='user' ) { %>
                                                                                        <form
                                                                                            action="/admin/update-role"
                                                                                            method="POST">
                                                                                            <input type="hidden"
                                                                                                name="userId"
                                                                                                value="<%= member.id %>">
                                                                                            <input type="hidden"
                                                                                                name="newRole"
                                                                                                value="user">
                                                                                            <button type="submit"
                                                                                                class="block w-full text-left px-4 py-3 text-sm text-gray-700 hover:bg-gray-50 hover:text-gray-600 font-medium transition flex items-center gap-2">
                                                                                                <i
                                                                                                    class="fas fa-user text-gray-400"></i>
                                                                                                Demote to User
                                                                                            </button>
                                                                                        </form>
                                                                                        <% } %>
                                                                </div>
                                                            </div>
                                                        </div>
                                                        <% } %>
                                                </td>
                                            </tr>
                                            <% }) %>
                                                <% } %>
                                </tbody>
                            </table>
                        </div>

                        <% if (typeof members !=='undefined' && members.length===0) { %>
                            <div class="text-center py-12">
                                <div
                                    class="w-16 h-16 bg-gray-50 rounded-full flex items-center justify-center mx-auto mb-4 text-gray-300">
                                    <i class="fas fa-users-slash text-2xl"></i>
                                </div>
                                <h3 class="text-gray-900 font-bold">No Members Found</h3>
                                <p class="text-gray-400 text-sm mt-1">There are no registered members in the system yet.
                                </p>
                            </div>
                            <% } %>
                    </div>



                    <% } else if (page==='financial_reports' ) { %>
                        <div
                            class="bg-white rounded-2xl shadow-sm border border-gray-100 flex-1 flex flex-col p-6 relative min-h-[600px]">
                            <div class="flex items-center justify-between mb-6">
                                <h2 class="text-[#003B73] text-xl font-bold">Financial Reports</h2>
                                <span class="bg-blue-50 text-blue-600 px-3 py-1 rounded-full text-xs font-bold">
                                    Total:  <%= typeof totalCollections !=='undefined' ?
                                        totalCollections.toLocaleString() : '0' %>
                                </span>
                            </div>

                            <div class="overflow-x-auto md:overflow-visible">
                                <table class="w-full text-left border-collapse">
                                    <thead>
                                        <tr
                                            class="text-xs text-gray-400 border-b border-gray-100 uppercase tracking-wider">
                                            <th class="py-3 font-semibold pl-4">Date</th>
                                            <th class="py-3 font-semibold">User / Donor</th>
                                            <th class="py-3 font-semibold">Type</th>
                                            <th class="py-3 font-semibold">Amount</th>
                                            <th class="py-3 font-semibold">Status</th>
                                        </tr>
                                    </thead>
                                    <tbody class="text-sm divide-y divide-gray-50">
                                        <% if (typeof transactions !=='undefined' && transactions.length> 0) { %>
                                            <% transactions.forEach(txn=> { %>
                                                <tr class="hover:bg-gray-50/50 transition">
                                                    <td class="py-3 pl-4 text-gray-600">
                                                        <%= new Date(txn.transactionDate).toLocaleDateString() %>
                                                    </td>
                                                    <td class="py-3">
                                                        <div class="font-bold text-gray-800">
                                                            <%= txn.user ? txn.user.fullName : 'Guest' %>
                                                        </div>
                                                        <div class="text-xs text-gray-500">
                                                            <%= txn.user ? txn.user.email : '-' %>
                                                        </div>
                                                    </td>
                                                    <td class="py-3">
                                                        <span
                                                            class="px-2 py-0.5 rounded text-xs font-medium uppercase bg-gray-100 text-gray-600">
                                                            <%= txn.type.replace('_', ' ' ) %>
                                                        </span>
                                                    </td>
                                                    <td class="py-3 font-bold text-gray-900">
                                                        <%= txn.currency %>
                                                            <%= txn.amount %>
                                                    </td>
                                                    <td class="py-3">
                                                        <span
                                                            class="px-2 py-0.5 rounded text-xs font-bold uppercase 
                                                            <%= txn.status === 'completed' ? 'bg-green-100 text-green-600' : 
                                                               txn.status === 'pending' ? 'bg-yellow-100 text-yellow-600' : 'bg-red-100 text-red-600' %>">
                                                            <%= txn.status %>
                                                        </span>
                                                    </td>
                                                </tr>
                                                <% }) %>
                                                    <% } else { %>
                                                        <tr>
                                                            <td colspan="5" class="py-8 text-center text-gray-400">
                                                                No transactions found.
                                                            </td>
                                                        </tr>
                                                        <% } %>
                                    </tbody>
                                </table>
                            </div>
                        </div>



                        <% } else if (page==='nsmosa_events' || page==='photo_gallery' || page==='reunion_gallery' ||
                            page==='alumni_events' || page==='alumni_directory' || page==='business_directory' ||
                            page==='executive_committee' ) { %>
                            <div class="flex-1 flex flex-col min-h-[600px]">
                                <% if (!locals.eventType) { %>
                                    <!-- Selection Screen -->
                                    <div class="flex items-center justify-center flex-1 w-full p-8">
                                        <div class="grid grid-cols-1 md:grid-cols-2 gap-8 max-w-4xl w-full">
                                            <!-- Social Events Card -->
                                            <a href="/admin/nsmosa-events?type=social_events"
                                                class="group relative overflow-hidden rounded-[2rem] shadow-xl hover:shadow-2xl transition-all duration-300 transform hover:-translate-y-2 aspect-square bg-[#001f3f] flex flex-col items-center justify-center text-center p-8">
                                                <div
                                                    class="absolute inset-0 bg-blue-900/20 group-hover:bg-blue-800/30 transition-colors">
                                                </div>
                                                <div class="relative z-10">
                                                    <i class="fas fa-users text-6xl text-white mb-6"></i>
                                                    <h2 class="text-3xl font-bold text-white mb-2">Social Events</h2>
                                                    <p
                                                        class="text-blue-200 text-sm font-medium flex items-center justify-center gap-1 group-hover:gap-2 transition-all">
                                                        View Years <i class="fas fa-arrow-right"></i>
                                                    </p>
                                                </div>
                                            </a>

                                            <!-- NSMOSA Events Card -->
                                            <a href="/admin/nsmosa-events?type=nsmosa_events"
                                                class="group relative overflow-hidden rounded-[2rem] shadow-xl hover:shadow-2xl transition-all duration-300 transform hover:-translate-y-2 aspect-square bg-gradient-to-br from-orange-400 to-orange-500 flex flex-col items-center justify-center text-center p-8">
                                                <div
                                                    class="absolute inset-0 bg-white/10 group-hover:bg-white/20 transition-colors">
                                                </div>
                                                <div class="relative z-10">
                                                    <i class="fas fa-star text-6xl text-white mb-6"></i>
                                                    <h2 class="text-3xl font-bold text-white mb-2">NSM ALUMNI EVENTS
                                                    </h2>
                                                    <p
                                                        class="text-orange-100 text-sm font-medium flex items-center justify-center gap-1 group-hover:gap-2 transition-all">
                                                        View Gallery <i class="fas fa-arrow-right"></i>
                                                    </p>
                                                </div>
                                            </a>
                                        </div>
                                    </div>
                                    <% } else { %>
                                        <!-- List / Gallery View -->
                                        <div
                                            class="bg-white rounded-2xl shadow-sm border border-gray-100 flex-1 flex flex-col p-6">
                                            <div class="flex items-center justify-between mb-8">
                                                <div class="flex items-center gap-4">
                                                    <a href="<%= (page === 'photo_gallery' || page === 'reunion_gallery' || page === 'alumni_events' || page === 'alumni_directory' || page === 'business_directory' || page === 'executive_committee') ? '/admin/dashboard' : '/admin/nsmosa-events' %>"
                                                        class="w-10 h-10 rounded-full bg-gray-100 flex items-center justify-center text-gray-600 hover:bg-gray-200 transition">
                                                        <i class="fas fa-arrow-left"></i>
                                                    </a>
                                                    <h2 class="text-[#003B73] text-2xl font-bold capitalize">
                                                        <%= eventType.replace('_', ' ' ) %>
                                                    </h2>
                                                </div>
                                                <button
                                                    onclick="document.getElementById('add-event-form').classList.toggle('hidden')"
                                                    class="bg-[#003B73] text-white px-6 py-3 rounded-xl font-bold hover:bg-blue-800 transition flex items-center gap-2 shadow-lg hover:shadow-xl">
                                                    <i class="fas fa-plus"></i>
                                                    <%= (page==='photo_gallery' || page==='reunion_gallery' )
                                                        ? 'Add Gallery' : (page==='alumni_events' ? 'Add Alumni Event' :
                                                        (page==='alumni_directory' ? 'Add Directory Entry' :
                                                        (page==='business_directory' ? 'Add Business' :
                                                        (page==='executive_committee' ? 'Add Member' : 'Add Event' ) )))
                                                        %>
                                                </button>
                                            </div>

                                            <!-- Add Event Form -->
                                            <div id="add-event-form" class="hidden mb-10"></div>
                                            <div
                                                class="bg-white border border-gray-100 rounded-[2rem] p-8 shadow-xl relative overflow-hidden">
                                                <!-- Decorative background element -->
                                                <div
                                                    class="absolute top-0 right-0 w-64 h-64 bg-blue-50 rounded-full blur-3xl -mr-32 -mt-32 opacity-50 pointer-events-none">
                                                </div>

                                                <form action="/admin/create-event" method="POST"
                                                    enctype="multipart/form-data" class="space-y-8 relative z-10">
                                                    <input type="hidden" name="eventType"
                                                        value="<%= eventType || page %>">


                                                    <div <div
                                                        class="<%= (page==='alumni_directory' || page==='business_directory' || page==='executive_committee') ? 'grid grid-cols-1 gap-8' : 'grid grid-cols-1 md:grid-cols-2 gap-8' %>">
                                                        <div class="group">
                                                            <label
                                                                class="block text-sm font-bold text-gray-700 mb-2 pl-1">
                                                                <%= (page==='photo_gallery' || page==='reunion_gallery'
                                                                    ) ? 'Gallery Name' : (page==='alumni_directory'
                                                                    ? 'Director Name' : (page==='business_directory'
                                                                    ? 'Business Name' : (page==='executive_committee'
                                                                    ? 'Member Name' : 'Event Name' ))) %>
                                                            </label>
                                                            <input type="text" name="eventName" required
                                                                class="w-full rounded-2xl bg-gray-50 border-gray-200 focus:bg-white focus:border-[#003B73] focus:ring-[#003B73] transition-all duration-300 py-3 px-4 font-medium"
                                                                placeholder="e.g. <%= page === 'executive_committee' ? 'John Doe' : (page === 'business_directory' ? 'Tech Solutions Inc.' : 'Annual Alumni Meet') %>">
                                                        </div>
                                                        <% if (page !=='alumni_directory' && page
                                                            !=='business_directory' && page !=='executive_committee' ) {
                                                            %>
                                                            <div class="group">
                                                                <label
                                                                    class="block text-sm font-bold text-gray-700 mb-2 pl-1">Year</label>
                                                                <input type="number" name="eventYear" required
                                                                    class="w-full rounded-2xl bg-gray-50 border-gray-200 focus:bg-white focus:border-[#003B73] focus:ring-[#003B73] transition-all duration-300 py-3 px-4 font-medium"
                                                                    placeholder="e.g. 2024" min="1900" max="2100">
                                                            </div>
                                                            <% } %>
                                                    </div>

                                                    <% if (page==='alumni_events' ) { %>
                                                        <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                                                            <div class="group">
                                                                <label
                                                                    class="block text-sm font-bold text-gray-700 mb-2 pl-1">Location</label>
                                                                <input type="text" name="location"
                                                                    class="w-full rounded-2xl bg-gray-50 border-gray-200 focus:bg-white focus:border-[#003B73] focus:ring-[#003B73] transition-all duration-300 py-3 px-4 font-medium"
                                                                    placeholder="e.g. School Auditorium">
                                                            </div>
                                                            <div class="group">
                                                                <label
                                                                    class="block text-sm font-bold text-gray-700 mb-2 pl-1">Timing</label>
                                                                <input type="text" name="timing"
                                                                    class="w-full rounded-2xl bg-gray-50 border-gray-200 focus:bg-white focus:border-[#003B73] focus:ring-[#003B73] transition-all duration-300 py-3 px-4 font-medium"
                                                                    placeholder="e.g. 10:00 AM - 6:00 PM">
                                                            </div>
                                                            <div class="group">
                                                                <label
                                                                    class="block text-sm font-bold text-gray-700 mb-2 pl-1">Date</label>
                                                                <input type="date" name="eventDate"
                                                                    class="w-full rounded-2xl bg-gray-50 border-gray-200 focus:bg-white focus:border-[#003B73] focus:ring-[#003B73] transition-all duration-300 py-3 px-4 font-medium">
                                                            </div>
                                                        </div>
                                                        <div class="group">
                                                            <label
                                                                class="block text-sm font-bold text-gray-700 mb-2 pl-1">Event
                                                                Description</label>
                                                            <textarea name="description" rows="3"
                                                                class="w-full rounded-2xl bg-gray-50 border-gray-200 focus:bg-white focus:border-[#003B73] focus:ring-[#003B73] transition-all duration-300 py-3 px-4 font-medium"
                                                                placeholder="Write something about the event..."></textarea>
                                                        </div>
                                                        <% } %>

                                                            <% if (page==='alumni_directory' ||
                                                                page==='executive_committee' ) { %>
                                                                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                                                    <% if (page==='alumni_directory' ) { %>
                                                                        <div class="group">
                                                                            <label
                                                                                class="block text-sm font-bold text-gray-700 mb-2 pl-1">Batch
                                                                                Year</label>
                                                                            <input type="text" name="batch"
                                                                                class="w-full rounded-2xl bg-gray-50 border-gray-200 focus:bg-white focus:border-[#003B73] focus:ring-[#003B73] transition-all duration-300 py-3 px-4 font-medium"
                                                                                placeholder="e.g. 2010">
                                                                        </div>
                                                                        <% } %>
                                                                            <div class="group">
                                                                                <label
                                                                                    class="block text-sm font-bold text-gray-700 mb-2 pl-1">
                                                                                    <%= page==='executive_committee'
                                                                                        ? 'Role/Designation'
                                                                                        : 'Profession' %>
                                                                                </label>
                                                                                <input type="text" name="profession"
                                                                                    class="w-full rounded-2xl bg-gray-50 border-gray-200 focus:bg-white focus:border-[#003B73] focus:ring-[#003B73] transition-all duration-300 py-3 px-4 font-medium"
                                                                                    placeholder="e.g. <%= page === 'executive_committee' ? 'Secretary' : 'Software Engineer' %>">
                                                                            </div>
                                                                </div>
                                                                <% } %>

                                                                    <% if (page==='business_directory' ) { %>
                                                                        <div
                                                                            class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                                                            <div class="group">
                                                                                <label
                                                                                    class="block text-sm font-bold text-gray-700 mb-2 pl-1">Industry/Category</label>
                                                                                <input type="text" name="profession"
                                                                                    class="w-full rounded-2xl bg-gray-50 border-gray-200 focus:bg-white focus:border-[#003B73] focus:ring-[#003B73] transition-all duration-300 py-3 px-4 font-medium"
                                                                                    placeholder="e.g. IT Services">
                                                                            </div>
                                                                            <div class="group">
                                                                                <label
                                                                                    class="block text-sm font-bold text-gray-700 mb-2 pl-1">Location/Address</label>
                                                                                <input type="text" name="location"
                                                                                    class="w-full rounded-2xl bg-gray-50 border-gray-200 focus:bg-white focus:border-[#003B73] focus:ring-[#003B73] transition-all duration-300 py-3 px-4 font-medium"
                                                                                    placeholder="e.g. Hyderabad, India">
                                                                            </div>
                                                                        </div>
                                                                        <div class="group mt-6">
                                                                            <label
                                                                                class="block text-sm font-bold text-gray-700 mb-2 pl-1">Business
                                                                                Description</label>
                                                                            <textarea name="description" rows="3"
                                                                                class="w-full rounded-2xl bg-gray-50 border-gray-200 focus:bg-white focus:border-[#003B73] focus:ring-[#003B73] transition-all duration-300 py-3 px-4 font-medium"
                                                                                placeholder="Brief description of the business..."></textarea>
                                                                        </div>
                                                                        <% } %>

                                                                            <% if (page==='executive_committee' ) { %>
                                                                                <div
                                                                                    class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                                                                                    <div class="group">
                                                                                        <label
                                                                                            class="block text-sm font-bold text-gray-700 mb-2 pl-1">Email
                                                                                            ID</label>
                                                                                        <input type="email"
                                                                                            name="location"
                                                                                            class="w-full rounded-2xl bg-gray-50 border-gray-200 focus:bg-white focus:border-[#003B73] focus:ring-[#003B73] transition-all duration-300 py-3 px-4 font-medium"
                                                                                            placeholder="e.g. member@example.com">
                                                                                    </div>
                                                                                    <div class="group">
                                                                                        <label
                                                                                            class="block text-sm font-bold text-gray-700 mb-2 pl-1">Professional
                                                                                            Details</label>
                                                                                        <textarea name="description"
                                                                                            rows="1"
                                                                                            class="w-full rounded-2xl bg-gray-50 border-gray-200 focus:bg-white focus:border-[#003B73] focus:ring-[#003B73] transition-all duration-300 py-3 px-4 font-medium"
                                                                                            placeholder="Enter professional details..."></textarea>
                                                                                    </div>
                                                                                </div>
                                                                                <% } %>

                                                                                    <% if (page !=='executive_committee'
                                                                                        ) { %>
                                                                                        <div>
                                                                                            <label
                                                                                                class="block text-sm font-bold text-gray-700 mb-2 pl-1">Gallery
                                                                                                Images</label>
                                                                                            <div
                                                                                                class="relative group cursor-pointer">
                                                                                                <div
                                                                                                    class="border-2 border-dashed border-gray-300 rounded-2xl p-10 text-center transition-all duration-300 group-hover:border-[#003B73] group-hover:bg-blue-50/30 bg-gray-50/50">
                                                                                                    <input type="file"
                                                                                                        name="images"
                                                                                                        id="event-images-input"
                                                                                                        multiple
                                                                                                        accept="image/*"
                                                                                                        required
                                                                                                        onchange="previewImages(this)"
                                                                                                        class="absolute inset-0 w-full h-full opacity-0 cursor-pointer z-20">

                                                                                                    <div
                                                                                                        class="flex flex-col items-center justify-center transition-transform duration-300 group-hover:scale-105">
                                                                                                        <div
                                                                                                            class="w-16 h-16 bg-white rounded-full shadow-md flex items-center justify-center mb-4 text-[#003B73]">
                                                                                                            <i
                                                                                                                class="fas fa-cloud-upload-alt text-2xl"></i>
                                                                                                        </div>
                                                                                                        <p
                                                                                                            class="text-base text-gray-600 font-bold mb-1 group-hover:text-[#003B73] transition-colors">
                                                                                                            Click to
                                                                                                            upload
                                                                                                            multiple
                                                                                                            images
                                                                                                        </p>
                                                                                                        <p
                                                                                                            class="text-xs text-gray-400">
                                                                                                            supports
                                                                                                            jpg,
                                                                                                            png, jpeg
                                                                                                        </p>
                                                                                                    </div>
                                                                                                </div>
                                                                                            </div>
                                                                                            <!-- Preview Container -->
                                                                                            <div id="image-preview-container"
                                                                                                class="grid grid-cols-2 md:grid-cols-4 gap-4 mt-6 empty:hidden transition-all duration-300">
                                                                                            </div>
                                                                                        </div>
                                                                                        <% } %>

                                                                                            <div
                                                                                                class="flex justify-end pt-2">
                                                                                                <button type="submit"
                                                                                                    class="bg-[#22c55e] hover:bg-[#16a34a] text-white px-8 py-3.5 rounded-xl font-bold shadow-lg shadow-green-500/30 transform transition-all duration-200 hover:-translate-y-1 hover:shadow-xl active:translate-y-0 text-base">
                                                                                                    <%= page==='photo_gallery'
                                                                                                        ? 'Upload & Save Gallery'
                                                                                                        :
                                                                                                        (page==='alumni_directory'
                                                                                                        ? 'Save Directory Entry'
                                                                                                        : 'Upload & Save Event'
                                                                                                        ) %>
                                                                                                </button>
                                                                                            </div>
                                                </form>
                                            </div>

                                        </div>



                                        <!-- Existing Events Grid -->
                                        <div class="grid grid-cols-1 md:grid-cols-3 lg:grid-cols-4 gap-6">
                                            <% if (events && events.length> 0) { %>
                                                <% events.forEach(evt=> { %>
                                                    <a href="#"
                                                        class="bg-white border border-gray-200 rounded-2xl overflow-hidden shadow-sm hover:shadow-lg transition group block h-full">
                                                        <div class="relative h-48 bg-gray-100 overflow-hidden">
                                                            <% if (page==='alumni_directory' ||
                                                                page==='business_directory' ||
                                                                page==='executive_committee' ) { %>
                                                                <% if (evt.imageUrl) { %>
                                                                    <img src="<%= evt.imageUrl %>"
                                                                        class="w-full h-full object-cover group-hover:scale-105 transition duration-500">
                                                                    <% } else { %>
                                                                        <div
                                                                            class="flex items-center justify-center h-full text-gray-300">
                                                                            <i class="fas fa-user text-4xl"></i>
                                                                        </div>
                                                                        <% } %>
                                                                            <% } else { %>
                                                                                <% if (evt.images && evt.images.length>
                                                                                    0) {
                                                                                    %>
                                                                                    <img src="<%= evt.images[0].imageUrl %>"
                                                                                        class="w-full h-full object-cover group-hover:scale-105 transition duration-500">
                                                                                    <% } else { %>
                                                                                        <div
                                                                                            class="flex items-center justify-center h-full text-gray-300">
                                                                                            <i
                                                                                                class="fas fa-image text-4xl"></i>
                                                                                        </div>
                                                                                        <% } %>
                                                                                            <% } %>
                                                                                                <div
                                                                                                    class="absolute inset-0 bg-black/0 group-hover:bg-black/10 transition">
                                                                                                </div>

                                                                                                <!-- Action Menu -->
                                                                                                <div
                                                                                                    class="absolute top-2 right-2 opacity-0 group-hover:opacity-100 transition-opacity z-20">
                                                                                                    <div
                                                                                                        class="relative">
                                                                                                        <button
                                                                                                            onclick="event.preventDefault(); document.getElementById('dropdown-<%= evt.id %>').classList.toggle('hidden')"
                                                                                                            class="bg-white text-gray-700 p-2 rounded-full shadow-md hover:bg-gray-100 w-8 h-8 flex items-center justify-center transition-transform hover:scale-105">
                                                                                                            <i
                                                                                                                class="fas fa-ellipsis-v text-xs"></i>
                                                                                                        </button>
                                                                                                        <div id="dropdown-<%= evt.id %>"
                                                                                                            class="hidden absolute right-0 mt-2 w-32 bg-white rounded-lg shadow-xl z-50 overflow-hidden ring-1 ring-black ring-opacity-5">
                                                                                                            <button
                                                                                                                data-title="<%= evt.title %>"
                                                                                                                data-year="<%= evt.year %>"
                                                                                                                data-section="<%= eventType || page %>"
                                                                                                                data-images='<%= (page === "alumni_directory" || page === "business_directory" || page === "executive_committee") ? JSON.stringify([{id: evt.id, imageUrl: evt.imageUrl}]) : JSON.stringify(evt.images) %>'
                                                                                                                <% if
                                                                                                                (eventType==='alumni_events'
                                                                                                                ||
                                                                                                                page==='alumni_events'
                                                                                                                ) { %>
                                                                                                                data-location="
                                                                                                                <%= evt.location
                                                                                                                    || ''
                                                                                                                    %>
                                                                                                                    "
                                                                                                                    data-timing="
                                                                                                                    <%= evt.timing
                                                                                                                        || ''
                                                                                                                        %>
                                                                                                                        "
                                                                                                                        data-eventdate="
                                                                                                                        <%= evt.eventDate
                                                                                                                            || ''
                                                                                                                            %>
                                                                                                                            "
                                                                                                                            data-description="
                                                                                                                            <%= evt.description
                                                                                                                                || ''
                                                                                                                                %>
                                                                                                                                "
                                                                                                                                <% }
                                                                                                                                    %>
                                                                                                                                    <% if
                                                                                                                                        (page==='business_directory'
                                                                                                                                        )
                                                                                                                                        {
                                                                                                                                        %>
                                                                                                                                        data-profession="
                                                                                                                                        <%= evt.profession
                                                                                                                                            || ''
                                                                                                                                            %>
                                                                                                                                            "
                                                                                                                                            data-location="
                                                                                                                                            <%= evt.location
                                                                                                                                                || ''
                                                                                                                                                %>
                                                                                                                                                "
                                                                                                                                                data-description="
                                                                                                                                                <%= evt.description
                                                                                                                                                    || ''
                                                                                                                                                    %>
                                                                                                                                                    "
                                                                                                                                                    <% }
                                                                                                                                                        %>

                                                                                                                                                        <% if
                                                                                                                                                            (page==='alumni_directory'
                                                                                                                                                            ||
                                                                                                                                                            page==='executive_committee'
                                                                                                                                                            )
                                                                                                                                                            {
                                                                                                                                                            %>
                                                                                                                                                            data-batch="
                                                                                                                                                            <%= evt.batch
                                                                                                                                                                || ''
                                                                                                                                                                %>
                                                                                                                                                                "
                                                                                                                                                                data-profession="
                                                                                                                                                                <%= evt.profession
                                                                                                                                                                    || ''
                                                                                                                                                                    %>
                                                                                                                                                                    "
                                                                                                                                                                    <% }
                                                                                                                                                                        %>
                                                                                                                                                                        onclick="event.preventDefault();
                                                                                                                                                                        handleEditModal(this)"
                                                                                                                                                                        class="block
                                                                                                                                                                        w-full
                                                                                                                                                                        text-left
                                                                                                                                                                        px-4
                                                                                                                                                                        py-2
                                                                                                                                                                        hover:bg-gray-50
                                                                                                                                                                        text-sm
                                                                                                                                                                        text-gray-700
                                                                                                                                                                        font-medium
                                                                                                                                                                        border-b
                                                                                                                                                                        border-gray-50">
                                                                                                                                                                        <i
                                                                                                                                                                            class="fas fa-edit mr-2 text-blue-500"></i>
                                                                                                                                                                        Edit
                                                                                                            </button>
                                                                                                            <form
                                                                                                                action="/admin/delete-event"
                                                                                                                method="POST"
                                                                                                                onsubmit="return confirm('Are you sure you want to delete this event and all its images?');">
                                                                                                                <input
                                                                                                                    type="hidden"
                                                                                                                    name="title"
                                                                                                                    value="<%= evt.title %>">
                                                                                                                <input
                                                                                                                    type="hidden"
                                                                                                                    name="year"
                                                                                                                    value="<%= evt.year %>">
                                                                                                                <input
                                                                                                                    type="hidden"
                                                                                                                    name="section"
                                                                                                                    value="<%= eventType %>">
                                                                                                                <button
                                                                                                                    type="submit"
                                                                                                                    class="block w-full text-left px-4 py-2 hover:bg-red-50 text-sm text-red-600 font-medium">
                                                                                                                    <i
                                                                                                                        class="fas fa-trash-alt mr-2"></i>
                                                                                                                    Delete
                                                                                                                </button>
                                                                                                            </form>
                                                                                                        </div>
                                                                                                    </div>
                                                                                                </div>

                                                        </div>
                                                        <div class="p-4">
                                                            <h4 class="font-bold text-gray-900 truncate text-lg">
                                                                <%= evt.title %>
                                                            </h4>

                                                            <% if (eventType==='alumni_events' ) { %>
                                                                <!-- Alumni Event Details -->
                                                                <div class="mt-3 space-y-2">
                                                                    <% if (evt.location) { %>
                                                                        <div
                                                                            class="flex items-start gap-2 text-sm text-gray-600">
                                                                            <i
                                                                                class="fas fa-map-marker-alt text-blue-500 mt-0.5 flex-shrink-0"></i>
                                                                            <span class="line-clamp-1">
                                                                                <%= evt.location %>
                                                                            </span>
                                                                        </div>
                                                                        <% } %>
                                                                            <% if (evt.timing) { %>
                                                                                <div
                                                                                    class="flex items-start gap-2 text-sm text-gray-600">
                                                                                    <i
                                                                                        class="fas fa-clock text-blue-500 mt-0.5 flex-shrink-0"></i>
                                                                                    <span class="line-clamp-1">
                                                                                        <%= evt.timing %>
                                                                                    </span>
                                                                                </div>
                                                                                <% } %>
                                                                                    <% if (evt.description) { %>
                                                                                        <p
                                                                                            class="text-xs text-gray-500 mt-2 line-clamp-2">
                                                                                            <%= evt.description %>
                                                                                        </p>
                                                                                        <% } %>
                                                                </div>
                                                                <% } %>

                                                                    <% if (page==='alumni_directory' ) { %>
                                                                        <!-- Alumni Directory Details -->
                                                                        <div class="mt-3 space-y-2">
                                                                            <% if (evt.batch) { %>
                                                                                <div
                                                                                    class="flex items-start gap-2 text-sm text-gray-600">
                                                                                    <i
                                                                                        class="fas fa-graduation-cap text-blue-500 mt-0.5 flex-shrink-0"></i>
                                                                                    <span class="line-clamp-1">Batch <%=
                                                                                            evt.batch %>
                                                                                    </span>
                                                                                </div>
                                                                                <% } %>
                                                                                    <% if (evt.profession) { %>
                                                                                        <div
                                                                                            class="flex items-start gap-2 text-sm text-gray-600">
                                                                                            <i
                                                                                                class="fas fa-briefcase text-blue-500 mt-0.5 flex-shrink-0"></i>
                                                                                            <span class="line-clamp-1">
                                                                                                <%= evt.profession %>
                                                                                            </span>
                                                                                        </div>
                                                                                        <% } %>
                                                                        </div>
                                                                        <% } %>


                                                                            <div
                                                                                class="flex items-center justify-between mt-3 pt-3 border-t border-gray-100">
                                                                                <% if (page !=='alumni_directory' &&
                                                                                    evt.year) { %>
                                                                                    <div
                                                                                        class="flex items-center gap-2 text-sm text-gray-500 font-medium">
                                                                                        <i
                                                                                            class="fas fa-calendar-alt text-gray-400"></i>
                                                                                        <span>
                                                                                            <%= evt.year %>
                                                                                        </span>
                                                                                    </div>
                                                                                    <% } else { %>
                                                                                        <div></div>
                                                                                        <% } %>
                                                                                            <span
                                                                                                class="text-xs bg-gray-100 text-gray-600 px-2.5 py-1 rounded-full font-semibold border border-gray-200">
                                                                                                <%= (page==='alumni_directory'
                                                                                                    ||
                                                                                                    page==='executive_committee'
                                                                                                    ) ? '1 Profile' :
                                                                                                    ((evt.images ?
                                                                                                    evt.images.length :
                                                                                                    0) + ' Items' ) %>
                                                                                            </span>
                                                                            </div>
                                                        </div>

                                                        <!-- Edit Modal (One generic modal appended at end of loop is better, but need unique IDs or JS to populate. I'll put the modal outside the loop) -->
                                                    </a>
                                                    <% }) %>
                                                        <% } else { %>
                                                            <div class="col-span-full py-12 text-center text-gray-400">
                                                                <i
                                                                    class="fas fa-folder-open text-4xl mb-4 text-gray-300"></i>
                                                                <p>No events found for this category.</p>
                                                            </div>
                                                            <% } %>
                                        </div>
                            </div>
                            <% } %>
    </div>
    <% } %>
        </main>
        </div>

        <!-- Edit Event Modal -->
        <div id="edit-event-modal"
            class="fixed inset-0 bg-[#001f3f]/40 z-[100] hidden flex items-center justify-center backdrop-blur-md transition-all duration-300 p-4">
            <div
                class="bg-white rounded-[2.5rem] w-full max-w-2xl p-0 shadow-2xl overflow-hidden transform transition-all">

                <!-- Modal Header -->
                <div
                    class="bg-gradient-to-r from-[#003B73] to-[#001f3f] px-8 py-6 flex items-center justify-between text-white">
                    <div>
                        <h3 class="text-2xl font-bold tracking-tight">Edit Gallery Details</h3>
                        <p class="text-blue-200/80 text-xs font-medium uppercase tracking-widest mt-1">
                            Manage content &
                            assets</p>
                    </div>
                    <button onclick="closeEditModal()"
                        class="w-10 h-10 rounded-full bg-white/10 flex items-center justify-center hover:bg-white/20 transition-all group">
                        <i class="fas fa-times text-lg group-hover:rotate-90 transition-transform"></i>
                    </button>
                </div>

                <div class="p-8">
                    <form action="/admin/update-event" method="POST" class="space-y-8">
                        <input type="hidden" name="section" id="edit-event-section">
                        <input type="hidden" name="originalTitle" id="edit-event-original-title">
                        <input type="hidden" name="originalYear" id="edit-event-original-year">

                        <!-- Basic Info Section -->
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div class="space-y-1.5">
                                <label
                                    class="block text-xs font-bold text-gray-500 uppercase tracking-wider pl-1 font-mono">Event/Gallery
                                    Name</label>
                                <input type="text" name="newTitle" id="edit-event-title" required
                                    class="w-full rounded-2xl bg-gray-50 border-gray-100 focus:bg-white focus:border-[#003B73] focus:ring-4 focus:ring-blue-50 transition-all duration-300 py-3.5 px-5 font-semibold text-gray-800">
                            </div>

                            <div class="space-y-1.5">
                                <label
                                    class="block text-xs font-bold text-gray-500 uppercase tracking-wider pl-1 font-mono">Year</label>
                                <input type="number" name="newYear" id="edit-event-year" required
                                    class="w-full rounded-2xl bg-gray-50 border-gray-100 focus:bg-white focus:border-[#003B73] focus:ring-4 focus:ring-blue-50 transition-all duration-300 py-3.5 px-5 font-semibold text-gray-800"
                                    min="1900" max="2100">
                            </div>
                        </div>

                        <!-- Alumni Event Specific Fields -->
                        <div id="alumni-event-fields" class="hidden space-y-6">
                            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                                <div class="space-y-1.5">
                                    <label
                                        class="block text-xs font-bold text-gray-500 uppercase tracking-wider pl-1 font-mono">Location</label>
                                    <input type="text" name="location" id="edit-event-location"
                                        class="w-full rounded-2xl bg-gray-50 border-gray-100 focus:bg-white focus:border-[#003B73] focus:ring-4 focus:ring-blue-50 transition-all duration-300 py-3.5 px-5 font-semibold text-gray-800"
                                        placeholder="e.g. School Auditorium">
                                </div>
                                <div class="space-y-1.5">
                                    <label
                                        class="block text-xs font-bold text-gray-500 uppercase tracking-wider pl-1 font-mono">Timing</label>
                                    <input type="text" name="timing" id="edit-event-timing"
                                        class="w-full rounded-2xl bg-gray-50 border-gray-100 focus:bg-white focus:border-[#003B73] focus:ring-4 focus:ring-blue-50 transition-all duration-300 py-3.5 px-5 font-semibold text-gray-800"
                                        placeholder="e.g. 10:00 AM - 6:00 PM">
                                </div>
                                <div class="space-y-1.5">
                                    <label
                                        class="block text-xs font-bold text-gray-500 uppercase tracking-wider pl-1 font-mono">Event
                                        Date</label>
                                    <input type="date" name="eventDate" id="edit-event-date"
                                        class="w-full rounded-2xl bg-gray-50 border-gray-100 focus:bg-white focus:border-[#003B73] focus:ring-4 focus:ring-blue-50 transition-all duration-300 py-3.5 px-5 font-semibold text-gray-800">
                                </div>
                            </div>
                            <div class="space-y-1.5">
                                <label
                                    class="block text-xs font-bold text-gray-500 uppercase tracking-wider pl-1 font-mono">Event
                                    Description</label>
                                <textarea name="description" id="edit-event-description" rows="3"
                                    class="w-full rounded-2xl bg-gray-50 border-gray-100 focus:bg-white focus:border-[#003B73] focus:ring-4 focus:ring-blue-50 transition-all duration-300 py-3.5 px-5 font-semibold text-gray-800"
                                    placeholder="Write something about the event..."></textarea>
                            </div>
                        </div>

                        <!-- Alumni Directory Specific Fields -->
                        <div id="alumni-directory-fields" class="hidden space-y-6">
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                <div class="space-y-1.5">
                                    <label
                                        class="block text-xs font-bold text-gray-500 uppercase tracking-wider pl-1 font-mono">Batch
                                        Year</label>
                                    <input type="text" name="batch" id="edit-directory-batch"
                                        class="w-full rounded-2xl bg-gray-50 border-gray-100 focus:bg-white focus:border-[#003B73] focus:ring-4 focus:ring-blue-50 transition-all duration-300 py-3.5 px-5 font-semibold text-gray-800"
                                        placeholder="e.g. 2010">
                                </div>
                                <div class="space-y-1.5">
                                    <label
                                        class="block text-xs font-bold text-gray-500 uppercase tracking-wider pl-1 font-mono">Profession</label>
                                    <input type="text" name="profession" id="edit-directory-profession"
                                        class="w-full rounded-2xl bg-gray-50 border-gray-100 focus:bg-white focus:border-[#003B73] focus:ring-4 focus:ring-blue-50 transition-all duration-300 py-3.5 px-5 font-semibold text-gray-800"
                                        placeholder="e.g. Software Engineer">
                                </div>
                            </div>
                        </div>


                        <!-- Business Directory Specific Fields -->
                        <div id="business-directory-fields" class="hidden space-y-6">
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                <div class="space-y-1.5">
                                    <label
                                        class="block text-xs font-bold text-gray-500 uppercase tracking-wider pl-1 font-mono">Industry/Category</label>
                                    <input type="text" name="profession" id="edit-business-category"
                                        class="w-full rounded-2xl bg-gray-50 border-gray-100 focus:bg-white focus:border-[#003B73] focus:ring-4 focus:ring-blue-50 transition-all duration-300 py-3.5 px-5 font-semibold text-gray-800"
                                        placeholder="e.g. IT Services">
                                </div>
                                <div class="space-y-1.5">
                                    <label
                                        class="block text-xs font-bold text-gray-500 uppercase tracking-wider pl-1 font-mono">Location/Address</label>
                                    <input type="text" name="location" id="edit-business-location"
                                        class="w-full rounded-2xl bg-gray-50 border-gray-100 focus:bg-white focus:border-[#003B73] focus:ring-4 focus:ring-blue-50 transition-all duration-300 py-3.5 px-5 font-semibold text-gray-800"
                                        placeholder="e.g. Hyderabad, India">
                                </div>
                            </div>
                            <div class="space-y-1.5">
                                <label
                                    class="block text-xs font-bold text-gray-500 uppercase tracking-wider pl-1 font-mono">Business
                                    Description</label>
                                <textarea name="description" id="edit-business-description" rows="3"
                                    class="w-full rounded-2xl bg-gray-50 border-gray-100 focus:bg-white focus:border-[#003B73] focus:ring-4 focus:ring-blue-50 transition-all duration-300 py-3.5 px-5 font-semibold text-gray-800"
                                    placeholder="Brief description..."></textarea>
                            </div>
                        </div>

                        <!-- Image Management Section -->
                        <div class="space-y-4">
                            <div class="flex items-center justify-between pl-1">
                                <label
                                    class="block text-xs font-bold text-gray-500 uppercase tracking-wider font-mono">Manage
                                    Images</label>
                                <span class="text-[10px] text-gray-400 font-bold bg-gray-100 px-2 py-0.5 rounded-full"
                                    id="image-count-badge">0 IMAGES</span>
                            </div>

                            <div id="edit-images-container"
                                class="grid grid-cols-3 sm:grid-cols-4 md:grid-cols-5 gap-4 max-h-[280px] overflow-y-auto pr-2 custom-scrollbar p-2 bg-gray-50/50 rounded-[1.5rem] border border-gray-100">
                                <!-- Dynamic Images Here -->
                            </div>
                        </div>

                        <!-- Action Buttons -->
                        <div class="flex items-center gap-4 pt-4">
                            <button type="button" onclick="closeEditModal()"
                                class="flex-1 px-6 py-4 rounded-2xl font-bold text-gray-600 bg-gray-100 hover:bg-gray-200 transition-all duration-200">
                                Close Editor
                            </button>
                            <button type="submit"
                                class="flex-[2] px-6 py-4 rounded-2xl font-bold text-white bg-gradient-to-r from-[#003B73] to-[#002a52] hover:shadow-[0_10px_20px_-5px_rgba(0,59,115,0.4)] transform hover:-translate-y-1 transition-all duration-200">
                                Synchronize & Save
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <style>
            .custom-scrollbar::-webkit-scrollbar {
                width: 6px;
            }

            .custom-scrollbar::-webkit-scrollbar-track {
                background: transparent;
            }

            .custom-scrollbar::-webkit-scrollbar-thumb {
                background: #e2e8f0;
                border-radius: 10px;
            }

            .custom-scrollbar::-webkit-scrollbar-thumb:hover {
                background: #cbd5e1;
            }
        </style>

        <script>
            function handleEditModal(btn) {
                const title = btn.getAttribute('data-title');
                const year = btn.getAttribute('data-year');
                const section = btn.getAttribute('data-section');
                const images = JSON.parse(btn.getAttribute('data-images'));
                const location = btn.getAttribute('data-location');
                const timing = btn.getAttribute('data-timing');
                const eventDate = btn.getAttribute('data-eventdate');
                const description = btn.getAttribute('data-description');
                const batch = btn.getAttribute('data-batch');
                const profession = btn.getAttribute('data-profession');

                openEditModal(title, year, section, images, location, timing, eventDate, description, batch, profession);
            }

            function openEditModal(title, year, section, images, location, timing, eventDate, description, batch, profession) {
                const modal = document.getElementById('edit-event-modal');
                modal.classList.remove('hidden');

                document.getElementById('edit-event-title').value = title;
                document.getElementById('edit-event-year').value = year;
                document.getElementById('edit-event-original-title').value = title;
                document.getElementById('edit-event-original-year').value = year;
                document.getElementById('edit-event-section').value = section;
                document.getElementById('image-count-badge').textContent = `${images.length} IMAGES`;

                // Show/hide alumni event fields
                // Show/hide fields based on section
                const alumniFields = document.getElementById('alumni-event-fields');
                const directoryFields = document.getElementById('alumni-directory-fields');
                const businessFields = document.getElementById('business-directory-fields');

                if (section === 'alumni_events') {
                    alumniFields.classList.remove('hidden');
                    directoryFields.classList.add('hidden');
                    businessFields.classList.add('hidden');
                    document.getElementById('edit-event-location').value = location || '';
                    document.getElementById('edit-event-timing').value = timing || '';
                    document.getElementById('edit-event-date').value = eventDate || '';
                    document.getElementById('edit-event-description').value = description || '';
                } else if (section === 'alumni_directory') {
                    directoryFields.classList.remove('hidden');
                    alumniFields.classList.add('hidden');
                    businessFields.classList.add('hidden');
                    document.getElementById('edit-directory-batch').value = batch || '';
                    document.getElementById('edit-directory-profession').value = profession || '';
                } else if (section === 'business_directory') {
                    businessFields.classList.remove('hidden');
                    alumniFields.classList.add('hidden');
                    directoryFields.classList.add('hidden');
                    document.getElementById('edit-business-category').value = profession || ''; // Using profession db field for category
                    document.getElementById('edit-business-location').value = location || '';
                    document.getElementById('edit-business-description').value = description || '';
                } else {
                    alumniFields.classList.add('hidden');
                    directoryFields.classList.add('hidden');
                    businessFields.classList.add('hidden');
                }


                const container = document.getElementById('edit-images-container');
                container.innerHTML = '';

                images.forEach(img => {
                    const div = document.createElement('div');
                    div.className = 'relative aspect-square rounded-xl overflow-hidden shadow-sm border border-white group bg-white';
                    div.innerHTML = `
                        <img src="${img.imageUrl}" class="w-full h-full object-cover">
                        <div class="absolute inset-0 bg-black/40 opacity-0 group-hover:opacity-100 transition-opacity flex items-center justify-center">
                            <button type="button" onclick="deleteSingleImage('${img.id}', this)" 
                                class="bg-red-500 text-white w-8 h-8 rounded-full flex items-center justify-center hover:bg-red-600 transition-all hover:scale-110 shadow-lg">
                                <i class="fas fa-trash-alt text-xs"></i>
                            </button>
                        </div>
                    `;
                    container.appendChild(div);
                });
            }

            function closeEditModal() {
                document.getElementById('edit-event-modal').classList.add('hidden');
            }

            async function deleteSingleImage(imageId, btnElement) {
                if (!confirm('Are you sure you want to delete this specific image?')) return;

                try {
                    const response = await fetch(`/admin/delete/${imageId}`, {
                        method: 'POST',
                    });

                    if (response.ok) {
                        btnElement.closest('.relative').remove();
                        const badge = document.getElementById('image-count-badge');
                        const currentCount = parseInt(badge.textContent) - 1;
                        badge.textContent = `${currentCount} IMAGES`;
                    } else {
                        alert('Failed to delete image');
                    }
                } catch (error) {
                    console.error('Error:', error);
                    alert('An error occurred while deleting the image');
                }
            }

            // Close dropdowns when clicking outside
            window.onclick = function (event) {
                if (!event.target.matches('.fa-ellipsis-v') && !event.target.closest('button')) {
                    var dropdowns = document.querySelectorAll('[id^="dropdown-"]');
                    dropdowns.forEach(function (openDropdown) {
                        if (!openDropdown.classList.contains('hidden')) {
                            openDropdown.classList.add('hidden');
                        }
                    });
                }
            }

            function previewImages(input) {
                const container = document.getElementById('image-preview-container');
                container.innerHTML = '';

                if (input.files) {
                    Array.from(input.files).forEach(file => {
                        const reader = new FileReader();
                        reader.onload = function (e) {
                            const div = document.createElement('div');
                            div.className = 'relative aspect-square rounded-xl overflow-hidden shadow-md group';

                            const img = document.createElement('img');
                            img.src = e.target.result;
                            img.className = 'w-full h-full object-cover transition-transform duration-300 group-hover:scale-110';

                            div.appendChild(img);
                            container.appendChild(div);
                        }
                        reader.readAsDataURL(file);
                    });
                    container.classList.remove('hidden');
                }
            }
        </script>

        <%- include('../partials/footer') %>